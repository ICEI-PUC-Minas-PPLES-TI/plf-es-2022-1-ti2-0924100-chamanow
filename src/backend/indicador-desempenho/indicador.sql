/*"1-" para cliente, "2-" para profissional e "3-" para empresa*/

/*Avaliação do Prestador
SELECT * FROM AVALIACAO_USUARIO WHERE COD_AVALIADO LIKE '2%';

SELECT COD_AVALIADO, AVG(NOTA) AS NOTA_MEDIA_PRESTADOR FROM AVALIACAO_USUARIO WHERE COD_AVALIADO LIKE '2%' GROUP BY COD_AVALIADO;
*/
SELECT A.COD_AVALIADO, B.COD_USUARIO, AVG(A.NOTA)  AS NOTA_MEDIA_PRESTADOR, B.NOME FROM AVALIACAO_USUARIO AS A JOIN USUARIO AS B ON A.COD_AVALIADO =  B.COD_USUARIO WHERE COD_AVALIADO LIKE '2%' GROUP BY A.COD_AVALIADO ORDER BY AVG(A.NOTA) DESC LIMIT 3;


/*Avaliação do Cliente*/
SELECT AVG(NOTA) AS NOTA_MEDIA_CLIENTE FROM AVALIACAO_USUARIO WHERE COD_AVALIADO LIKE '1%';


/*Tempo para a realização do serviço*/
SELECT SUM(DATEDIFF (DATA_PAGAMENTO,DATA_SERVICO)) / COUNT(DATA_SERVICO) AS TEMPO_SERVICO_MEDIO FROM AGENDAMENTO GROUP BY MONTH(DATA_PAGAMENTO);

/*Serviços agendados*/
SELECT COUNT(DATA_SOLICITACAO) / COUNT(COD_SERVICO)* 100 AS SERVIÇOS_AGENDADOS FROM AGENDAMENTO GROUP BY MONTH(DATA_SOLICITACAO) AND COD_SERVICO;

/*Cancelamento*/
SELECT COUNT(CASE WHEN STATUS LIKE 'Cancelado' THEN 1 END) / COUNT(CASE WHEN STATUS LIKE 'Concluído' THEN 1 END) *100  AS CANCELAMENTO FROM AGENDAMENTO GROUP BY MONTH(DATA_SOLICITACAO);

/*Cadastro de Usuários*/
SELECT MONTH(DATA_CRIACAO), YEAR(DATA_CRIACAO), COUNT(DATA_CRIACAO) AS CADASTRO_USUARIOS FROM USUARIO GROUP BY MONTH(DATA_CRIACAO) , YEAR(DATA_CRIACAO) ORDER BY 1,2;

/*Cadastro de Prestadores*/
SELECT MONTH(DATA_CRIACAO), YEAR(DATA_CRIACAO), COUNT(CASE WHEN COD_TIPO IS NOT NULL THEN 1 END)  AS CADASTRO_PRESTADORES FROM USUARIO GROUP BY MONTH(DATA_CRIACAO) , YEAR(DATA_CRIACAO) ORDER BY 1,2;

/*Serviços mais contratados*/
SELECT B.NOME, COUNT(CASE WHEN A.COD_TIPO IS NOT NULL THEN 1 END) AS SERVICOS_MAIS_CONTRATADOS FROM AGENDAMENTO AS A JOIN TIPO_SERVICO AS B ON A.COD_TIPO = B.COD_TIPO GROUP BY A.COD_TIPO ORDER BY COUNT(CASE WHEN COD_TIPO IS NOT NULL THEN 1 END) DESC LIMIT 3;

/*Preço médio dos serviços*/
SELECT B.NOME, SUM(CASE WHEN A.VALOR_ORCAMENTO IS NOT NULL THEN 1 END) / COUNT(CASE WHEN A.COD_TIPO IS NOT NULL THEN 1 END) AS PRECO_MEDIO_SERVICO FROM AGENDAMENTO AS A JOIN TIPO_SERVICO AS B ON A.COD_TIPO = B.COD_TIPO WHERE A.VALOR_ORCAMENTO IS NOT NULL GROUP BY A.COD_TIPO;

/*Quantidade de serviços pendentes*/
SELECT COUNT(CASE WHEN STATUS LIKE 'Pendente' THEN 1 END) / COUNT(CASE WHEN COD_TIPO IS NOT NULL THEN 1 END) *100 AS CANCELAMENTO FROM AGENDAMENTO GROUP BY MONTH(DATA_SOLICITACAO);

/*Quantidade de serviços não pagos*/
SELECT COUNT(CASE WHEN STATUS LIKE 'Nâo Pago' THEN 1 END) / COUNT(CASE WHEN COD_TIPO IS NOT NULL THEN 1 END) *100 AS CANCELAMENTO FROM AGENDAMENTO GROUP BY MONTH(DATA_SOLICITACAO);





SELECT DATA_PAGAMENTO, DATA_SERVICO, DATEDIFF (DATA_PAGAMENTO,DATA_SERVICO) AS TEMPO_SERVICO_MEDIO FROM AGENDAMENTO WHERE COD_SERVICO = 595;





INSERT INTO AGENDAMENTO(COD_SERVICO, VALOR_ORCAMENTO,NUM_COMPROVANTE,DATA_SERVICO,HORARIO,DATA_PAGAMENTO,DESCRICAOSTATUS,DATA_SOLICITACAO,COD_STATUS, STATUS) VALUES(555,'R$450',5326,STR_TO_DATE("04/06/2022", "%d/%m/%Y"), '11:53',STR_TO_DATE("10/06/2022", "%d/%m/%Y"), 'BLABLABLA',STR_TO_DATE("01/06/2022", "%d/%m/%Y"),12467, 'Cancelado');
INSERT INTO AGENDAMENTO(COD_SERVICO, VALOR_ORCAMENTO,NUM_COMPROVANTE,DATA_SERVICO,HORARIO,DATA_PAGAMENTO,DESCRICAOSTATUS,DATA_SOLICITACAO,COD_STATUS, STATUS) VALUES(595,'R$1230',1566,STR_TO_DATE("07/06/2022", "%d/%m/%Y"), '11:53',STR_TO_DATE("14/06/2022", "%d/%m/%Y"), 'BLABLABLA',STR_TO_DATE("02/06/2022", "%d/%m/%Y"),19567, 'Concluído');
INSERT INTO AGENDAMENTO(COD_SERVICO, VALOR_ORCAMENTO,NUM_COMPROVANTE,DATA_SERVICO,HORARIO,DATA_PAGAMENTO,DESCRICAOSTATUS,DATA_SOLICITACAO,COD_STATUS, STATUS) VALUES(575,'R$4500',5986,STR_TO_DATE("10/06/2022", "%d/%m/%Y"), '11:53',STR_TO_DATE("11/06/2022", "%d/%m/%Y"), 'BLABLABLA',STR_TO_DATE("01/06/2022", "%d/%m/%Y"),19567, 'Concluído');
INSERT INTO AGENDAMENTO(COD_SERVICO, VALOR_ORCAMENTO,NUM_COMPROVANTE,DATA_SERVICO,HORARIO,DATA_PAGAMENTO,DESCRICAOSTATUS,DATA_SOLICITACAO,COD_STATUS, STATUS) VALUES(535,'R$123',9856,STR_TO_DATE("03/06/2022", "%d/%m/%Y"), '11:53',STR_TO_DATE("12/06/2022", "%d/%m/%Y"), 'BLABLABLA',STR_TO_DATE("01/06/2022", "%d/%m/%Y"),19567, 'Concluído');
INSERT INTO AGENDAMENTO(COD_SERVICO, VALOR_ORCAMENTO,NUM_COMPROVANTE,DATA_SERVICO,HORARIO,DATA_PAGAMENTO,DESCRICAOSTATUS,DATA_SOLICITACAO,COD_STATUS, STATUS) VALUES(576,'R$45',3156,STR_TO_DATE("05/06/2022", "%d/%m/%Y"), '11:53',STR_TO_DATE("13/06/2022", "%d/%m/%Y"), 'BLABLABLA',STR_TO_DATE("03/06/2022", "%d/%m/%Y"),12467, 'Cancelado');
INSERT INTO AGENDAMENTO(COD_SERVICO, VALOR_ORCAMENTO,NUM_COMPROVANTE,DATA_SERVICO,HORARIO,DATA_PAGAMENTO,DESCRICAOSTATUS,DATA_SOLICITACAO,COD_STATUS, STATUS) VALUES(512,'R$12',0978,STR_TO_DATE("06/06/2022", "%d/%m/%Y"), '11:53',STR_TO_DATE("15/06/2022", "%d/%m/%Y"), 'BLABLABLA',STR_TO_DATE("01/06/2022", "%d/%m/%Y"),19567, 'Concluído');
INSERT INTO AGENDAMENTO(COD_SERVICO, VALOR_ORCAMENTO,NUM_COMPROVANTE,DATA_SERVICO,HORARIO,DATA_PAGAMENTO,DESCRICAOSTATUS,DATA_SOLICITACAO,COD_STATUS, STATUS) VALUES(502,'R$132',0078,STR_TO_DATE("09/06/2022", "%d/%m/%Y"), '11:53',STR_TO_DATE("18/06/2022", "%d/%m/%Y"), 'BLABLABLA',STR_TO_DATE("01/06/2022", "%d/%m/%Y"),10092, 'Pendente');
INSERT INTO AGENDAMENTO(COD_SERVICO, VALOR_ORCAMENTO,NUM_COMPROVANTE,DATA_SERVICO,HORARIO,DATA_PAGAMENTO,DESCRICAOSTATUS,DATA_SOLICITACAO,COD_STATUS, STATUS) VALUES(402,'R$1332',1278,STR_TO_DATE("10/06/2022", "%d/%m/%Y"), '11:53',STR_TO_DATE("20/06/2022", "%d/%m/%Y"), 'BLABLABLA',STR_TO_DATE("01/06/2022", "%d/%m/%Y"),10092, 'Pendente');

INSERT INTO AGENDAMENTO(COD_SERVICO, VALOR_ORCAMENTO,NUM_COMPROVANTE,DATA_SERVICO,HORARIO,DATA_PAGAMENTO,DESCRICAOSTATUS,DATA_SOLICITACAO,COD_STATUS, STATUS, COD_TIPO) VALUES(410,'R$1332',1908,STR_TO_DATE("10/06/2022", "%d/%m/%Y"), '11:53',STR_TO_DATE("20/06/2022", "%d/%m/%Y"), 'BLABLABLA',STR_TO_DATE("01/06/2022", "%d/%m/%Y"),10092, 'Cancelado', 500);
INSERT INTO AGENDAMENTO(COD_SERVICO, VALOR_ORCAMENTO,NUM_COMPROVANTE,DATA_SERVICO,HORARIO,DATA_PAGAMENTO,DESCRICAOSTATUS,DATA_SOLICITACAO,COD_STATUS, STATUS, COD_TIPO) VALUES(411,'R$1332',1909,STR_TO_DATE("10/06/2022", "%d/%m/%Y"), '11:53',STR_TO_DATE("20/06/2022", "%d/%m/%Y"), 'BLABLABLA',STR_TO_DATE("01/06/2022", "%d/%m/%Y"),19567, 'Concluído', 872);
INSERT INTO AGENDAMENTO(COD_SERVICO, VALOR_ORCAMENTO,NUM_COMPROVANTE,DATA_SERVICO,HORARIO,DATA_PAGAMENTO,DESCRICAOSTATUS,DATA_SOLICITACAO,COD_STATUS, STATUS, COD_TIPO) VALUES(412,'R$1332',1910,STR_TO_DATE("10/06/2022", "%d/%m/%Y"), '11:53',STR_TO_DATE("20/06/2022", "%d/%m/%Y"), 'BLABLABLA',STR_TO_DATE("01/06/2022", "%d/%m/%Y"),19567, 'Concluído', 100);
INSERT INTO AGENDAMENTO(COD_SERVICO, VALOR_ORCAMENTO,NUM_COMPROVANTE,DATA_SERVICO,HORARIO,DATA_PAGAMENTO,DESCRICAOSTATUS,DATA_SOLICITACAO,COD_STATUS, STATUS, COD_TIPO) VALUES(413,'R$1332',1911,STR_TO_DATE("10/06/2022", "%d/%m/%Y"), '11:53',STR_TO_DATE("20/06/2022", "%d/%m/%Y"), 'BLABLABLA',STR_TO_DATE("01/06/2022", "%d/%m/%Y"),19567, 'Concluído', 100);
INSERT INTO AGENDAMENTO(COD_SERVICO, VALOR_ORCAMENTO,NUM_COMPROVANTE,DATA_SERVICO,HORARIO,DATA_PAGAMENTO,DESCRICAOSTATUS,DATA_SOLICITACAO,COD_STATUS, STATUS, COD_TIPO) VALUES(414,'R$1332',1912,STR_TO_DATE("10/06/2022", "%d/%m/%Y"), '11:53',STR_TO_DATE("20/06/2022", "%d/%m/%Y"), 'BLABLABLA',STR_TO_DATE("01/06/2022", "%d/%m/%Y"),19567, 'Concluído', 100);
INSERT INTO AGENDAMENTO(COD_SERVICO, VALOR_ORCAMENTO,NUM_COMPROVANTE,DATA_SERVICO,HORARIO,DATA_PAGAMENTO,DESCRICAOSTATUS,DATA_SOLICITACAO,COD_STATUS, STATUS, COD_TIPO) VALUES(489,'R$1332',1914,STR_TO_DATE("10/06/2022", "%d/%m/%Y"), '11:53',STR_TO_DATE("20/06/2022", "%d/%m/%Y"), 'BLABLABLA',STR_TO_DATE("01/06/2022", "%d/%m/%Y"),19567, 'Concluído', 872);
INSERT INTO AGENDAMENTO(COD_SERVICO, VALOR_ORCAMENTO,NUM_COMPROVANTE,DATA_SERVICO,HORARIO,DATA_PAGAMENTO,DESCRICAOSTATUS,DATA_SOLICITACAO,COD_STATUS, STATUS, COD_TIPO) VALUES(464,'R$1332',1953,STR_TO_DATE("10/06/2022", "%d/%m/%Y"), '11:53',STR_TO_DATE("20/06/2022", "%d/%m/%Y"), 'BLABLABLA',STR_TO_DATE("01/06/2022", "%d/%m/%Y"),19567, 'Concluído', 500);
INSERT INTO AGENDAMENTO(COD_SERVICO, VALOR_ORCAMENTO,NUM_COMPROVANTE,DATA_SERVICO,HORARIO,DATA_PAGAMENTO,DESCRICAOSTATUS,DATA_SOLICITACAO,COD_STATUS, STATUS, COD_TIPO) VALUES(425,'R$1332',1968,STR_TO_DATE("10/06/2022", "%d/%m/%Y"), '11:53',STR_TO_DATE("20/06/2022", "%d/%m/%Y"), 'BLABLABLA',STR_TO_DATE("01/06/2022", "%d/%m/%Y"),19567, 'Concluído', 150);


SELECT COD_AVALIADO FROM AVALIACAO_USUARIO WHERE COD_AVALIADO LIKE '1%';

SELECT COD_AVALIADO FROM AVALIACAO_USUARIO WHERE COD_AVALIADO LIKE '2%';






INSERT INTO AVALIACAO_USUARIO(COD_AVALIADOR, COD_AVALIADO, NOTA, COMENTARIO, DATA_AVALIACAO) VALUES(20072,18724,4.3,"Muito bom",STR_TO_DATE("06/06/2022", "%d/%m/%Y"));
INSERT INTO AVALIACAO_USUARIO(COD_AVALIADOR, COD_AVALIADO, NOTA, COMENTARIO, DATA_AVALIACAO) VALUES(20072,18724,3.7,"Muito bom",STR_TO_DATE("09/06/2022", "%d/%m/%Y"));
INSERT INTO AVALIACAO_USUARIO(COD_AVALIADOR, COD_AVALIADO, NOTA, COMENTARIO, DATA_AVALIACAO) VALUES(20072,18724,1.2,"Muito bom",STR_TO_DATE("11/06/2022", "%d/%m/%Y"));
INSERT INTO AVALIACAO_USUARIO(COD_AVALIADOR, COD_AVALIADO, NOTA, COMENTARIO, DATA_AVALIACAO) VALUES(20072,18724,5.0,"Muito bom",STR_TO_DATE("29/06/2022", "%d/%m/%Y"));
INSERT INTO AVALIACAO_USUARIO(COD_AVALIADOR, COD_AVALIADO, NOTA, COMENTARIO, DATA_AVALIACAO) VALUES(20072,185739,2.9,"Mediano",STR_TO_DATE("19/06/2022", "%d/%m/%Y"));

INSERT INTO AVALIACAO_USUARIO(COD_AVALIADOR, COD_AVALIADO, NOTA, COMENTARIO, DATA_AVALIACAO) VALUES(18724,20072,4.7,"Muito bom",STR_TO_DATE("11/06/2022", "%d/%m/%Y"));
INSERT INTO AVALIACAO_USUARIO(COD_AVALIADOR, COD_AVALIADO, NOTA, COMENTARIO, DATA_AVALIACAO) VALUES(185739,20072,2.8,"Mediano",STR_TO_DATE("04/06/2022", "%d/%m/%Y"));

INSERT INTO AVALIACAO_USUARIO(COD_AVALIADOR, COD_AVALIADO, NOTA, COMENTARIO, DATA_AVALIACAO) VALUES(18724,29483,5.0,"Muito bom",STR_TO_DATE("10/06/2022", "%d/%m/%Y"));
INSERT INTO AVALIACAO_USUARIO(COD_AVALIADOR, COD_AVALIADO, NOTA, COMENTARIO, DATA_AVALIACAO) VALUES(185739,29074,2.8,"Muito ruim",STR_TO_DATE("12/06/2022", "%d/%m/%Y"));
INSERT INTO AVALIACAO_USUARIO(COD_AVALIADOR, COD_AVALIADO, NOTA, COMENTARIO, DATA_AVALIACAO) VALUES(18724,25553,4.1,"Bom",STR_TO_DATE("15/06/2022", "%d/%m/%Y"));
INSERT INTO AVALIACAO_USUARIO(COD_AVALIADOR, COD_AVALIADO, NOTA, COMENTARIO, DATA_AVALIACAO) VALUES(185739,24546,2.0,"Péssimo",STR_TO_DATE("16/06/2022", "%d/%m/%Y"));
INSERT INTO AVALIACAO_USUARIO(COD_AVALIADOR, COD_AVALIADO, NOTA, COMENTARIO, DATA_AVALIACAO) VALUES(18724,29483,4.9,"Muito bom",STR_TO_DATE("20/06/2022", "%d/%m/%Y"));
INSERT INTO AVALIACAO_USUARIO(COD_AVALIADOR, COD_AVALIADO, NOTA, COMENTARIO, DATA_AVALIACAO) VALUES(185739,29074,2.0,"Ruim",STR_TO_DATE("14/06/2022", "%d/%m/%Y"));
INSERT INTO AVALIACAO_USUARIO(COD_AVALIADOR, COD_AVALIADO, NOTA, COMENTARIO, DATA_AVALIACAO) VALUES(18724,25553,4.0,"Ok",STR_TO_DATE("16/06/2022", "%d/%m/%Y"));
INSERT INTO AVALIACAO_USUARIO(COD_AVALIADOR, COD_AVALIADO, NOTA, COMENTARIO, DATA_AVALIACAO) VALUES(185739,24546,2.0,"Péssimo",STR_TO_DATE("22/06/2022", "%d/%m/%Y"));



INSERT INTO TIPO_SERVICO (COD_TIPO,NOME,DESCRICAO) VALUES(987, "ENCANAMENTO", "Arrumamos cano");

INSERT INTO USUARIO(COD_USUARIO, REGIAO_ATUACAO, EMAIL, SENHA, NOME, CPF, DATA_NASC, DATA_CRIACAO, COD_TIPO) VALUES(20072,"Caveirinha","adelson@gmail.com","123adelson","Adelson","123.456.789-10",STR_TO_DATE("01/02/2000", "%d/%m/%Y"),STR_TO_DATE("06/06/2022", "%d/%m/%Y"), 987);

INSERT INTO USUARIO(COD_USUARIO, EMAIL, SENHA, NOME, CPF, DATA_NASC, DATA_CRIACAO) VALUES(18724,"alonso@gmail.com","123alonso","alonso","109.876.654-12",STR_TO_DATE("21/08/1987", "%d/%m/%Y"),STR_TO_DATE("05/05/2021", "%d/%m/%Y"));

INSERT INTO USUARIO(COD_USUARIO, EMAIL, SENHA, NOME, CPF, DATA_NASC, DATA_CRIACAO) VALUES(185739,"marcola@gmail.com","123marcola","Marcola","189.374.050-72",STR_TO_DATE("20/09/1980", "%d/%m/%Y"),STR_TO_DATE("02/04/2021", "%d/%m/%Y"));



INSERT INTO USUARIO(COD_USUARIO, REGIAO_ATUACAO, EMAIL, SENHA, NOME, CPF, DATA_NASC, DATA_CRIACAO, COD_TIPO) VALUES(29483,"Bahia","milton@gmail.com","123milton","Milton","189.374.050-31",STR_TO_DATE("20/09/2000", "%d/%m/%Y"),STR_TO_DATE("12/05/2022", "%d/%m/%Y"), 100);
INSERT INTO USUARIO(COD_USUARIO, REGIAO_ATUACAO, EMAIL, SENHA, NOME, CPF, DATA_NASC, DATA_CRIACAO, COD_TIPO) VALUES(29074,"Sabara","maluco@gmail.com","123maluco","Maluco","189.374.050-90",STR_TO_DATE("29/07/1990", "%d/%m/%Y"),STR_TO_DATE("01/03/2022", "%d/%m/%Y"), 150);
INSERT INTO USUARIO(COD_USUARIO, EMAIL, REGIAO_ATUACAO, SENHA, NOME, CPF, DATA_NASC, DATA_CRIACAO, COD_TIPO) VALUES(25553,"Contagem","doidao@gmail.com","123doidao","Doidao","189.374.050-06",STR_TO_DATE("21/10/1994", "%d/%m/%Y"),STR_TO_DATE("07/04/2022", "%d/%m/%Y"), 872);
INSERT INTO USUARIO(COD_USUARIO, EMAIL, REGIAO_ATUACAO, SENHA, NOME, CPF, DATA_NASC, DATA_CRIACAO, COD_TIPO) VALUES(24546,"Salvador","louco@gmail.com","123louco","Louco","189.374.050-12",STR_TO_DATE("27/09/1999", "%d/%m/%Y"),STR_TO_DATE("12/05/202", "%d/%m/%Y"), 500);



INSERT INTO TIPO_SERVICO(COD_TIPO, NOME, DESCRICAO) VALUES(100, "Marcenaria", "Corta arvore");
INSERT INTO TIPO_SERVICO(COD_TIPO, NOME, DESCRICAO) VALUES(150, "Ferreiro", "Corta ferro");
INSERT INTO TIPO_SERVICO(COD_TIPO, NOME, DESCRICAO) VALUES(872, "Eletricista", "Corta cabo");
INSERT INTO TIPO_SERVICO(COD_TIPO, NOME, DESCRICAO) VALUES(500, "Lavador", "Lava tudo");

